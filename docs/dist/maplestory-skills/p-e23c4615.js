import{h as e}from"./p-455083c6.js";import{R as l,M as i,a as r}from"./p-303cc661.js";function s(e,s,p,o){let t={},k=0,a=0;o&&e[o.prop]>0&&o.skillRequirements&&o.skillRequirements.forEach(l=>{!function e(l,i){l[i.skill.prop]<i.level&&(l[i.skill.prop]=i.level),i.skill.skillRequirements&&i.skill.skillRequirements.forEach(i=>{e(l,i)})}(e,l)}),Object.keys(s).forEach(i=>{let r=s[i];r.rank===l.Basic?k+=e[r.prop]:a+=e[r.prop],t[r.prop]={locked:!1,required:void 0,limitReached:!1}}),p||(o&&o.rank===l.Basic&&k>i&&(e[o.prop]-=k-i),o&&o.rank===l.Awakening&&a>r&&(e[o.prop]-=a-r)),Object.keys(s).forEach(o=>{let n=s[o];if(n.skillRequirements&&n.skillRequirements.forEach(l=>{e[l.skill.prop]<l.level&&(t[n.prop].locked=!0,e[n.prop]=0)}),!p&&(t[n.prop].limitReached=n.rank===l.Basic?k>=i:a>=r,0===e[n.prop])){let s=function(e,l){let i={};return l.skillRequirements?(function l(r){r.skillRequirements.forEach(r=>{let s=Math.max(0,r.level-e[r.skill.prop]);(!i[r.skill.prop]||i[r.skill.prop]<s)&&(i[r.skill.prop]=s),r.skill.skillRequirements&&l(r.skill)})}(l),Object.keys(i).reduce((e,l)=>e+i[l],0)):0}(e,n);n.rank===l.Basic?s+1>i-k&&(t[n.prop].limitReached=!0):s+1>r-a&&(t[n.prop].limitReached=!0)}}),e.skills=t}function p(e,l,i){if(l.skillRequirements){let r=!1;l.skillRequirements.forEach(l=>{if(e[l.skill.prop]<l.level){let s=i?`Level ${l.level}+`:void 0;e.skills[l.skill.prop].required!==s&&(e.skills[l.skill.prop].required=s,r=!0)}}),r&&(e.skills=Object.assign({},e.skills))}}function o(i,r,s,o=!1,t=l.Basic,k){return Object.keys(r).map(l=>{let a=r[l],n=i.skills[a.prop];return e("ms-skill",Object.assign({slot:"rank-"+t,class:a.prop,skill:a,level:i[a.prop],locked:n.locked,required:n.required,limitReached:n.limitReached,disabled:!s,loop:s,onLevelchanged:e=>i.levelChanged(a,e.detail),onMouseEnter:()=>n.locked&&p(i,a,!0),onMouseLeave:()=>n.locked&&p(i,a,!1),extras:o},k))})}function t(e,l,i){let r={rank:e.rank,skills:Object.keys(l).map(i=>{let r=l[i];return{skill:r.name,attr:r.attr,prop:r.prop,level:e[r.prop],minLevel:r.minLevel,maxLevel:r.maxLevel,rank:r.rank}})};return i&&(r.other=Object.keys(i).map(e=>({attr:e,value:i[e]}))),r}export{s as p,o as r,t};